// ==UserScript==
// @name         Bahamut Anime Comment Mountains
// @version      0.2.2
// @description  彈幕密度山脈 for 巴哈姆特動畫瘋
// @author       JacobLinCool <jacoblincool@gmail.com> (https://github.com/JacobLinCool)
// @license      MIT
// @homepage     https://github.com/JacobLinCool/Bahamut-Anime-Comment-Mountains#readme
// @supportURL   https://github.com/JacobLinCool/Bahamut-Anime-Comment-Mountains/issues
// @updateURL    https://github.com/JacobLinCool/Bahamut-Anime-Comment-Mountains/raw/dist/baha-anime-mountains.min.user.js
// @downloadURL  https://github.com/JacobLinCool/Bahamut-Anime-Comment-Mountains/raw/dist/baha-anime-mountains.min.user.js
// @namespace    http://tampermonkey.net/
// @match        https://ani.gamer.com.tw/animeVideo.php?sn=*
// @icon         https://www.google.com/s2/favicons?domain=gamer.com.tw
// @grant        none
// ==/UserScript==

(()=>{var ve=Object.defineProperty;var ye=(e,t,n)=>t in e?ve(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var S=(e,t,n)=>(ye(e,typeof t!="symbol"?t+"":t,n),n);var N=(e,t,n)=>new Promise((r,s)=>{var o=_=>{try{u(n.next(_))}catch(f){s(f)}},d=_=>{try{u(n.throw(_))}catch(f){s(f)}},u=_=>_.done?r(_.value):Promise.resolve(_.value).then(o,d);u((n=n.apply(e,t)).next())});function k(...e){e.length>=1?console.log("%c[\u5F48\u5E55\u5C71\u8108]","color: orange; font-weight: bold;",...e):console.log()}function $(e,t=3){return N(this,null,function*(){for(let n=0;n<t;n++)try{return yield e()}catch(r){k("Retry",n+1,e,r)}throw k("Failed",e),new Error("Failed")})}function X(e,t){return new Promise(n=>setTimeout(()=>n(t),e))}var M,g,Y,be,q,Z,ee,xe,W={},te=[],we=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i;function P(e,t){for(var n in t)e[n]=t[n];return e}function ne(e){var t=e.parentNode;t&&t.removeChild(e)}function l(e,t,n){var r,s,o,d={};for(o in t)o=="key"?r=t[o]:o=="ref"?s=t[o]:d[o]=t[o];if(arguments.length>2&&(d.children=arguments.length>3?M.call(arguments,2):n),typeof e=="function"&&e.defaultProps!=null)for(o in e.defaultProps)d[o]===void 0&&(d[o]=e.defaultProps[o]);return B(e,d,r,s,null)}function B(e,t,n,r,s){var o={type:e,props:t,key:n,ref:r,__k:null,__:null,__b:0,__e:null,__d:void 0,__c:null,__h:null,constructor:void 0,__v:s==null?++Y:s};return s==null&&g.vnode!=null&&g.vnode(o),o}function F(e){return e.children}function z(e,t){this.props=e,this.context=t}function I(e,t){if(t==null)return e.__?I(e.__,e.__.__k.indexOf(e)+1):null;for(var n;t<e.__k.length;t++)if((n=e.__k[t])!=null&&n.__e!=null)return n.__e;return typeof e.type=="function"?I(e):null}function oe(e){var t,n;if((e=e.__)!=null&&e.__c!=null){for(e.__e=e.__c.base=null,t=0;t<e.__k.length;t++)if((n=e.__k[t])!=null&&n.__e!=null){e.__e=e.__c.base=n.__e;break}return oe(e)}}function ie(e){(!e.__d&&(e.__d=!0)&&q.push(e)&&!R.__r++||ee!==g.debounceRendering)&&((ee=g.debounceRendering)||Z)(R)}function R(){for(var e;R.__r=q.length;)e=q.sort(function(t,n){return t.__v.__b-n.__v.__b}),q=[],e.some(function(t){var n,r,s,o,d,u;t.__d&&(d=(o=(n=t).__v).__e,(u=n.__P)&&(r=[],(s=P({},o)).__v=o.__v+1,J(u,o,s,n.__n,u.ownerSVGElement!==void 0,o.__h!=null?[d]:null,r,d==null?I(o):d,o.__h),de(r,o),o.__e!=d&&oe(o)))})}function re(e,t,n,r,s,o,d,u,_,f){var i,m,c,a,p,A,v,y=r&&r.__k||te,w=y.length;for(n.__k=[],i=0;i<t.length;i++)if((a=n.__k[i]=(a=t[i])==null||typeof a=="boolean"?null:typeof a=="string"||typeof a=="number"||typeof a=="bigint"?B(null,a,null,null,a):Array.isArray(a)?B(F,{children:a},null,null,null):a.__b>0?B(a.type,a.props,a.key,null,a.__v):a)!=null){if(a.__=n,a.__b=n.__b+1,(c=y[i])===null||c&&a.key==c.key&&a.type===c.type)y[i]=void 0;else for(m=0;m<w;m++){if((c=y[m])&&a.key==c.key&&a.type===c.type){y[m]=void 0;break}c=null}J(e,a,c=c||W,s,o,d,u,_,f),p=a.__e,(m=a.ref)&&c.ref!=m&&(v||(v=[]),c.ref&&v.push(c.ref,null,a),v.push(m,a.__c||p,a)),p!=null?(A==null&&(A=p),typeof a.type=="function"&&a.__k===c.__k?a.__d=_=se(a,_,e):_=ae(e,a,c,y,p,_),typeof n.type=="function"&&(n.__d=_)):_&&c.__e==_&&_.parentNode!=e&&(_=I(c))}for(n.__e=A,i=w;i--;)y[i]!=null&&(typeof n.type=="function"&&y[i].__e!=null&&y[i].__e==n.__d&&(n.__d=I(r,i+1)),ue(y[i],y[i]));if(v)for(i=0;i<v.length;i++)pe(v[i],v[++i],v[++i])}function se(e,t,n){for(var r,s=e.__k,o=0;s&&o<s.length;o++)(r=s[o])&&(r.__=e,t=typeof r.type=="function"?se(r,t,n):ae(n,r,r,s,r.__e,t));return t}function ae(e,t,n,r,s,o){var d,u,_;if(t.__d!==void 0)d=t.__d,t.__d=void 0;else if(n==null||s!=o||s.parentNode==null)e:if(o==null||o.parentNode!==e)e.appendChild(s),d=null;else{for(u=o,_=0;(u=u.nextSibling)&&_<r.length;_+=2)if(u==s)break e;e.insertBefore(s,o),d=o}return d!==void 0?d:s.nextSibling}function ke(e,t,n,r,s){var o;for(o in n)o==="children"||o==="key"||o in t||H(e,o,null,n[o],r);for(o in t)s&&typeof t[o]!="function"||o==="children"||o==="key"||o==="value"||o==="checked"||n[o]===t[o]||H(e,o,t[o],n[o],r)}function le(e,t,n){t[0]==="-"?e.setProperty(t,n):e[t]=n==null?"":typeof n!="number"||we.test(t)?n:n+"px"}function H(e,t,n,r,s){var o;e:if(t==="style")if(typeof n=="string")e.style.cssText=n;else{if(typeof r=="string"&&(e.style.cssText=r=""),r)for(t in r)n&&t in n||le(e.style,t,"");if(n)for(t in n)r&&n[t]===r[t]||le(e.style,t,n[t])}else if(t[0]==="o"&&t[1]==="n")o=t!==(t=t.replace(/Capture$/,"")),t=t.toLowerCase()in e?t.toLowerCase().slice(2):t.slice(2),e.l||(e.l={}),e.l[t+o]=n,n?r||e.addEventListener(t,o?_e:ce,o):e.removeEventListener(t,o?_e:ce,o);else if(t!=="dangerouslySetInnerHTML"){if(s)t=t.replace(/xlink[H:h]/,"h").replace(/sName$/,"s");else if(t!=="href"&&t!=="list"&&t!=="form"&&t!=="tabIndex"&&t!=="download"&&t in e)try{e[t]=n==null?"":n;break e}catch(d){}typeof n=="function"||(n!=null&&(n!==!1||t[0]==="a"&&t[1]==="r")?e.setAttribute(t,n):e.removeAttribute(t))}}function ce(e){this.l[e.type+!1](g.event?g.event(e):e)}function _e(e){this.l[e.type+!0](g.event?g.event(e):e)}function J(e,t,n,r,s,o,d,u,_){var f,i,m,c,a,p,A,v,y,w,U,C=t.type;if(t.constructor!==void 0)return null;n.__h!=null&&(_=n.__h,u=t.__e=n.__e,t.__h=null,o=[u]),(f=g.__b)&&f(t);try{e:if(typeof C=="function"){if(v=t.props,y=(f=C.contextType)&&r[f.__c],w=f?y?y.props.value:f.__:r,n.__c?A=(i=t.__c=n.__c).__=i.__E:("prototype"in C&&C.prototype.render?t.__c=i=new C(v,w):(t.__c=i=new z(v,w),i.constructor=C,i.render=Se),y&&y.sub(i),i.props=v,i.state||(i.state={}),i.context=w,i.__n=r,m=i.__d=!0,i.__h=[]),i.__s==null&&(i.__s=i.state),C.getDerivedStateFromProps!=null&&(i.__s==i.state&&(i.__s=P({},i.__s)),P(i.__s,C.getDerivedStateFromProps(v,i.__s))),c=i.props,a=i.state,m)C.getDerivedStateFromProps==null&&i.componentWillMount!=null&&i.componentWillMount(),i.componentDidMount!=null&&i.__h.push(i.componentDidMount);else{if(C.getDerivedStateFromProps==null&&v!==c&&i.componentWillReceiveProps!=null&&i.componentWillReceiveProps(v,w),!i.__e&&i.shouldComponentUpdate!=null&&i.shouldComponentUpdate(v,i.__s,w)===!1||t.__v===n.__v){i.props=v,i.state=i.__s,t.__v!==n.__v&&(i.__d=!1),i.__v=t,t.__e=n.__e,t.__k=n.__k,t.__k.forEach(function(j){j&&(j.__=t)}),i.__h.length&&d.push(i);break e}i.componentWillUpdate!=null&&i.componentWillUpdate(v,i.__s,w),i.componentDidUpdate!=null&&i.__h.push(function(){i.componentDidUpdate(c,a,p)})}i.context=w,i.props=v,i.state=i.__s,(f=g.__r)&&f(t),i.__d=!1,i.__v=t,i.__P=e,f=i.render(i.props,i.state,i.context),i.state=i.__s,i.getChildContext!=null&&(r=P(P({},r),i.getChildContext())),m||i.getSnapshotBeforeUpdate==null||(p=i.getSnapshotBeforeUpdate(c,a)),U=f!=null&&f.type===F&&f.key==null?f.props.children:f,re(e,Array.isArray(U)?U:[U],t,n,r,s,o,d,u,_),i.base=t.__e,t.__h=null,i.__h.length&&d.push(i),A&&(i.__E=i.__=null),i.__e=!1}else o==null&&t.__v===n.__v?(t.__k=n.__k,t.__e=n.__e):t.__e=Ce(n.__e,t,n,r,s,o,d,_);(f=g.diffed)&&f(t)}catch(j){t.__v=null,(_||o!=null)&&(t.__e=u,t.__h=!!_,o[o.indexOf(u)]=null),g.__e(j,t,n)}}function de(e,t){g.__c&&g.__c(t,e),e.some(function(n){try{e=n.__h,n.__h=[],e.some(function(r){r.call(n)})}catch(r){g.__e(r,n.__v)}})}function Ce(e,t,n,r,s,o,d,u){var _,f,i,m=n.props,c=t.props,a=t.type,p=0;if(a==="svg"&&(s=!0),o!=null){for(;p<o.length;p++)if((_=o[p])&&"setAttribute"in _==!!a&&(a?_.localName===a:_.nodeType===3)){e=_,o[p]=null;break}}if(e==null){if(a===null)return document.createTextNode(c);e=s?document.createElementNS("http://www.w3.org/2000/svg",a):document.createElement(a,c.is&&c),o=null,u=!1}if(a===null)m===c||u&&e.data===c||(e.data=c);else{if(o=o&&M.call(e.childNodes),f=(m=n.props||W).dangerouslySetInnerHTML,i=c.dangerouslySetInnerHTML,!u){if(o!=null)for(m={},p=0;p<e.attributes.length;p++)m[e.attributes[p].name]=e.attributes[p].value;(i||f)&&(i&&(f&&i.__html==f.__html||i.__html===e.innerHTML)||(e.innerHTML=i&&i.__html||""))}if(ke(e,c,m,s,u),i)t.__k=[];else if(p=t.props.children,re(e,Array.isArray(p)?p:[p],t,n,r,s&&a!=="foreignObject",o,d,o?o[0]:n.__k&&I(n,0),u),o!=null)for(p=o.length;p--;)o[p]!=null&&ne(o[p]);u||("value"in c&&(p=c.value)!==void 0&&(p!==m.value||p!==e.value||a==="progress"&&!p)&&H(e,"value",p,m.value,!1),"checked"in c&&(p=c.checked)!==void 0&&p!==e.checked&&H(e,"checked",p,m.checked,!1))}return e}function pe(e,t,n){try{typeof e=="function"?e(t):e.current=t}catch(r){g.__e(r,n)}}function ue(e,t,n){var r,s;if(g.unmount&&g.unmount(e),(r=e.ref)&&(r.current&&r.current!==e.__e||pe(r,null,t)),(r=e.__c)!=null){if(r.componentWillUnmount)try{r.componentWillUnmount()}catch(o){g.__e(o,t)}r.base=r.__P=null}if(r=e.__k)for(s=0;s<r.length;s++)r[s]&&ue(r[s],t,typeof e.type!="function");n||e.__e==null||ne(e.__e),e.__e=e.__d=void 0}function Se(e,t,n){return this.constructor(e,n)}function V(e,t,n){var r,s,o;g.__&&g.__(e,t),s=(r=typeof n=="function")?null:n&&n.__k||t.__k,o=[],J(t,e=(!r&&n||t).__k=l(F,null,[e]),s||W,W,t.ownerSVGElement!==void 0,!r&&n?[n]:s?null:t.firstChild?M.call(t.childNodes):null,o,!r&&n?n:s?s.__e:t.firstChild,r),de(o,e)}M=te.slice,g={__e:function(e,t){for(var n,r,s;t=t.__;)if((n=t.__c)&&!n.__)try{if((r=n.constructor)&&r.getDerivedStateFromError!=null&&(n.setState(r.getDerivedStateFromError(e)),s=n.__d),n.componentDidCatch!=null&&(n.componentDidCatch(e),s=n.__d),s)return n.__E=n}catch(o){e=o}throw e}},Y=0,be=function(e){return e!=null&&e.constructor===void 0},z.prototype.setState=function(e,t){var n;n=this.__s!=null&&this.__s!==this.state?this.__s:this.__s=P({},this.state),typeof e=="function"&&(e=e(P({},n),this.props)),e&&P(n,e),e!=null&&this.__v&&(t&&this.__h.push(t),ie(this))},z.prototype.forceUpdate=function(e){this.__v&&(this.__e=!0,e&&this.__h.push(e),ie(this))},z.prototype.render=F,q=[],Z=typeof Promise=="function"?Promise.prototype.then.bind(Promise.resolve()):setTimeout,R.__r=0,xe=0;var K={colorful:!0,always:!1,opacity:.3,wait:1e3,segments:50,threshold:300},D=JSON.parse(localStorage.getItem("bahamut-anime-comment-mountains-configs")||JSON.stringify(K));function O(e){return D[e]}function E(e,t){D[e]=t,localStorage.setItem("bahamut-anime-comment-mountains-configs",JSON.stringify(D))}function fe(){localStorage.removeItem("bahamut-anime-comment-mountains-configs");for(let e in D)K.hasOwnProperty(e)?E(e,K[e]):delete D[e]}var h={get colorful(){return O("colorful")},get always(){return O("always")},get opacity(){return O("opacity")},get wait(){return O("wait")},get segments(){return O("segments")},get threshold(){return O("threshold")},set colorful(e){e=!!e,E("colorful",e)},set always(e){e=!!e,E("always",e)},set opacity(e){e=parseFloat(e)||.3,E("opacity",e)},set wait(e){e=parseInt(e)||1e3,E("wait",e)},set segments(e){e=parseInt(e)||50,E("segments",e)},set threshold(e){e=parseInt(e)||300,E("threshold",e)}};function me(){let{canvas:e,ctx:t}=he();h.always?document.querySelector("video-js").appendChild(e):document.querySelector(".control-bar-mask").appendChild(e);let{canvas:n,ctx:r}=he();return n.style.zIndex=15,document.querySelector(".R18").appendChild(n),Pe(),{canvas:e,ctx:t,preview:n,preview_ctx:r}}function he(){let e=document.createElement("canvas");Object.assign(e,{width:1e3,height:300}),Object.assign(e.style,{position:"absolute",bottom:0,left:0,width:"100%",zIndex:5,"pointer-events":"none"});let t=e.getContext("2d");return Object.assign(t,{fillStyle:"white",strokeStyle:"white",lineJoin:"round",lineCap:"round",lineWidth:2}),{canvas:e,ctx:t}}function Pe(){let e=document.querySelector(".sub_top.ani-tabs"),t=document.querySelector(".ani-tab-content"),n=l("div",{id:"cm-settings",class:"ani-tabs__item"},l("a",{class:"ani-tabs-link",href:"#ani-tab-content-cm",onClick:s=>{document.querySelector(".ani-tabs-link.is-active").classList.remove("is-active"),s.target.classList.add("is-active"),document.querySelectorAll(".ani-tab-content__item").forEach(o=>{o.style.display="none"}),document.querySelector("#ani-tab-content-cm").style.display="block",s.preventDefault()}},"\u5F48\u5E55\u5C71\u8108")),r=l("div",{class:"ani-tab-content__item",id:"ani-tab-content-cm",style:"display: none"},l("div",{class:"ani-setting-section"},l("h4",{class:"ani-setting-title"},"\u5C71\u8108\u8A2D\u5B9A"),l("div",{class:"ani-setting-item ani-flex"},l("div",{class:"ani-setting-label"},l("span",{class:"ani-setting-label__mian"},"\u6301\u7E8C\u986F\u793A")),l("div",{class:"ani-setting-value ani-set-flex-right"},l("div",{class:"ani-checkbox"},l("label",{class:"ani-checkbox__label"},l("input",{id:"cm-always",type:"checkbox",name:"ani-checkbox",checked:h.always,onChange:s=>{window.cm.always=s.target.checked}}),l("div",{class:"ani-checkbox__button"}))))),l("div",{class:"ani-setting-item ani-flex"},l("div",{class:"ani-setting-label"},l("span",{class:"ani-setting-label__mian"},"\u5F69\u8272\u986F\u793A")),l("div",{class:"ani-setting-value ani-set-flex-right"},l("div",{class:"ani-checkbox"},l("label",{class:"ani-checkbox__label"},l("input",{id:"cm-colorful",type:"checkbox",name:"ani-checkbox",checked:h.colorful,onChange:s=>{window.cm.colorful=s.target.checked}}),l("div",{class:"ani-checkbox__button"}))))),l("div",{class:"ani-setting-item ani-flex"},l("div",{class:"ani-setting-label"},l("span",{class:"ani-setting-label__mian"},"\u4E0D\u900F\u660E\u5EA6"),l("span",{class:"ani-setting-label__sub",id:"cm-opacity-label"},h.opacity*100,"%")),l("div",{class:"ani-setting-value ani-set-flex-right"},l("div",{class:"ani-range",id:"cm-opacity-range"},l("input",{type:"range",id:"cm-opacity",max:"100",min:"10",step:"10",value:h.opacity*100,onChange:s=>{window.cm.opacity=parseInt(s.target.value)/100,document.querySelector("#cm-opacity-label").innerText=s.target.value+"%"}})))),l("div",{class:"ani-setting-item ani-flex"},l("div",{class:"ani-setting-label"},l("span",{class:"ani-setting-label__mian"},"\u71B1\u5EA6\u95A5\u503C"),l("span",{class:"ani-setting-label__sub",id:"cm-threshold-label"},h.threshold)),l("div",{class:"ani-setting-value ani-set-flex-right"},l("div",{class:"ani-range",id:"cm-threshold-input"},l("input",{type:"number",id:"cm-threshold",max:"1000",min:"0",step:"10",value:h.threshold,onChange:s=>{window.cm.threshold=parseInt(s.target.value),document.querySelector("#cm-threshold-label").innerText=s.target.value}})))),l("div",{class:"ani-setting-item ani-flex"},l("div",{class:"ani-setting-label"},l("span",{class:"ani-setting-label__mian"},"\u5207\u7247\u5927\u5C0F"),l("span",{class:"ani-setting-label__sub",id:"cm-segments-label"},h.segments)),l("div",{class:"ani-setting-value ani-set-flex-right"},l("div",{class:"ani-range",id:"cm-segments-input"},l("input",{type:"number",id:"cm-segments",max:"1000",min:"0",step:"10",value:h.segments,onChange:s=>{window.cm.segments=parseInt(s.target.value),document.querySelector("#cm-segments-label").innerText=s.target.value}}))))),l("style",null,'#ani-tab-content-cm input[type="number"] ',"{","border: none; color: #54c3e0; font-size: 2rem; text-align: right; ","}"));V(n,e.appendChild(document.createElement("div"))),V(r,t.appendChild(document.createElement("div")))}var Q=class{constructor(t){S(this,"text","");S(this,"userid","");S(this,"color","");S(this,"position",0);S(this,"size",0);S(this,"sn",0);S(this,"time",0);Object.assign(this,t)}},L=class{constructor(t=0,n=0){S(this,"x",0);S(this,"y",0);this.x=t,this.y=n}};var b,x,T=[],ge=null;(function(){return N(this,null,function*(){yield X(h.wait),De();let e=me();b=e.canvas,x=e.ctx,T=yield Ee(),G(),e.preview_ctx.drawImage(b,0,0),qe()})})();function G(){let{max:e,heights:t}=Te(),n=Ae(t);Ie(e),Oe(),Ne(n)}function Ee(e=!1){return N(this,null,function*(){let n=(yield $(()=>fetch("https://ani.gamer.com.tw/ajax/danmuGet.php",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:`sn=${location.search.match(/\d+/)[0]}`}).then(r=>r.json()))).map(r=>new Q(r));if(k("Comments",n),e){let r=yield $(()=>fetch("https://ani.gamer.com.tw/ajax/keywordGet.php").then(s=>s.json()).then(s=>s.map(o=>o.keyword)));return n.filter(s=>!r.some(o=>s.text.includes(o)))}return n})}function Te(){T=T.sort((o,d)=>o.time-d.time);let e=(ge||T[T.length-1].time)/h.segments;k("Width",e);let t=new Array(h.segments).fill(0),n=0;for(let o=0;o<T.length;o++){for(;T[o].time>(n+1)*e+.1;)n++;t[n]++}t.splice(h.segments,t.length-h.segments),k("Heights",t);let r=Math.max(...t);k("Max",r);let s=t.map(o=>o/r);return k("Normalized",s),{max:r,heights:s}}function Ae(e){let t=[];for(let n=0;n<e.length;n++)t.push(new L(b.width/e.length*(n+.5),b.height*.5*(2-e[n])));return t}function Ie(e){let t=e-h.threshold<50?e-h.threshold:50;if(k("Color Offset",t),h.colorful){let n=x.createLinearGradient(0,b.height*.5+t,0,b.height);n.addColorStop(0,"#BF616A"),n.addColorStop(.4,"#EBCB8B"),n.addColorStop(.5,"#EBCB8B"),n.addColorStop(1,"#A3BE8C"),x.fillStyle=n}else x.fillStyle="white"}function Oe(){h.opacity?x.globalAlpha=h.opacity:x.globalAlpha=.3}function Ne(e){let t=[new L(0,b.height),...e,new L(b.width,b.height)],n=.3,r=.6,s=0,o=0,d=0,u=0,_=0;x.clearRect(0,0,b.width,b.height),x.beginPath(),x.moveTo(0,b.height);let f=t[0];for(let i=0;i<t.length;i++){let m=t[i],c=t[i+1];c?(s=(c.y-f.y)/(c.x-f.x),u=(c.x-m.x)*-n,_=u*s*r):(s=0,u=0,_=0),x.bezierCurveTo(f.x-o,f.y-d,m.x+u,m.y+_,m.x,m.y),o=u,d=_,f=m}x.lineTo(b.width,b.height),x.closePath(),x.fill()}function qe(){window.cm={reset(){fe(),G()}};for(let e in h)Object.defineProperty(window.cm,e,{get:()=>h[e],set:t=>{h[e]=t,e==="always"?t?document.querySelector("video-js").appendChild(b):document.querySelector(".control-bar-mask").appendChild(b):e==="wait"?k("Wait",t):G()}})}function De(){let e=document.querySelector("video"),t={attributes:!0,attributeFilter:["src"]};new MutationObserver(r=>{r.forEach(s=>{s.attributeName==="src"&&e.addEventListener("loadedmetadata",()=>{k("Real Video Duration",e.duration),ge=e.duration*10,G()})})}).observe(e,t)}})();
